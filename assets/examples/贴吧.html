<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è´´å§æ¨¡æ‹Ÿå™¨</title>
<script type="text/javascript" nonce="a71d16c1a5ec4ad6b0c9724c03a" src="//injections.adguard.org?ts=1762261586344&amp;type=content-script&amp;dmn=www.dzmm.ai&amp;url=https%3A%2F%2Fwww.dzmm.ai%2Fgamefy%2Ftieba.html&amp;app=chrome.exe&amp;css=3&amp;js=1&amp;rel=1&amp;rji=1&amp;sbe=0"></script><script type="text/javascript" nonce="a71d16c1a5ec4ad6b0c9724c03a" src="//injections.adguard.org?ts=1762261586344&amp;name=AdGuard%20Extra&amp;name=AdGuard%20Popup%20Blocker&amp;type=user-script"></script></head>
<body>
  <div id="app" x-data="tiebaApp" @scroll.window="handleScroll">
    <!-- è¾“å…¥é¡µ -->
    <div x-show="view === 'input'" class="input-view">
      <div class="input-container">
        <div class="logo">
          <div class="logo-icon">è´´</div>
          <h1>è´´å§æ¨¡æ‹Ÿå™¨</h1>
        </div>
        <p class="subtitle">è¾“å…¥è´´å§åç§°ï¼ŒAI ä¸ºä½ ç”Ÿæˆç‹¬ç‰¹çš„è´´å§å†…å®¹</p>
        <div class="search-box">
          <input
            type="text"
            x-model="tiebaName"
            @keyup.enter="enterTieba"
            placeholder="è¾“å…¥è´´å§åç§°ï¼Œå¦‚ï¼šææ¯…å§ã€é­”å…½ä¸–ç•Œå§..."
            maxlength="20"
          />
          <button
            @click="enterTieba"
            :disabled="!tiebaName.trim() || isLoading"
            class="enter-btn"
          >
            <span x-show="!isLoading">è¿›å…¥è´´å§</span>
            <span x-show="isLoading">åŠ è½½ä¸­...</span>
          </button>
        </div>
      </div>
    </div>

    <!-- åˆ—è¡¨é¡µ -->
    <div x-show="view === 'list'" class="list-view">
      <div class="header-bar">
        <div class="container">
          <button @click="backToInput" class="back-btn">â† è¿”å›</button>
          <h2 class="tieba-title" x-text="$store.tieba.name + 'å§'"></h2>
        </div>
      </div>

      <div class="container">
        <div class="post-list">
          <template x-for="post in $store.tieba.posts" :key="post.id">
            <div class="post-item" @click="viewPost(post.id)">
              <div class="post-avatar" :style="'background: ' + post.avatar"></div>
              <div class="post-content">
                <h3 class="post-title" x-text="post.title"></h3>
                <div class="post-meta">
                  <span class="post-author" x-text="post.author"></span>
                  <span class="post-time" x-text="post.timestamp"></span>
                  <span class="post-replies" x-text="post.replyCount + ' å›å¤'"></span>
                </div>
              </div>
            </div>
          </template>

          <!-- åŠ è½½çŠ¶æ€ -->
          <div x-show="isLoading" class="loading-state">
            <div class="loading-spinner"></div>
            <p>æ­£åœ¨ç”Ÿæˆæ–°å¸–å­...</p>
          </div>

          <!-- ç©ºçŠ¶æ€ -->
          <div x-show="$store.tieba.posts.length === 0 && !isLoading" class="empty-state">
            <p>ğŸ‰ è¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„è´´å§ï¼Œè®©æˆ‘ä»¬å¼€å§‹ç”Ÿæˆå†…å®¹å§ï¼</p>
          </div>
        </div>
      </div>
    </div>

    <!-- è¯¦æƒ…é¡µ -->
    <div x-show="view === 'detail'" class="detail-view">
      <div class="header-bar">
        <div class="container">
          <button @click="backToList" class="back-btn">â† è¿”å›åˆ—è¡¨</button>
        </div>
      </div>

      <div class="container">
        <!-- åŠ è½½çŠ¶æ€ -->
        <div x-show="isLoading && !$store.tieba.currentPost" class="loading-state">
          <div class="loading-spinner"></div>
          <p>æ­£åœ¨ç”Ÿæˆå¸–å­è¯¦æƒ…...</p>
        </div>

        <!-- å¸–å­è¯¦æƒ… -->
        <div x-show="$store.tieba.currentPost" class="post-detail">
          <h1 class="detail-title" x-text="$store.tieba.currentPost?.title"></h1>

          <!-- æ¥¼ä¸» -->
          <div class="floor-item floor-main">
            <div class="floor-header">
              <div class="floor-avatar" :style="'background: ' + $store.tieba.currentPost?.avatar"></div>
              <div class="floor-info">
                <span class="floor-author" x-text="$store.tieba.currentPost?.author"></span>
                <span class="floor-label">æ¥¼ä¸»</span>
              </div>
            </div>
            <div class="floor-content" x-html="$store.tieba.currentPost?.content"></div>
          </div>

          <!-- å›å¤åˆ—è¡¨ -->
          <div class="replies-section">
            <template x-for="reply in $store.tieba.currentPost?.replies || []" :key="reply.floor">
              <div class="floor-item">
                <div class="floor-header">
                  <div class="floor-avatar" :style="'background: ' + reply.avatar"></div>
                  <div class="floor-info">
                    <span class="floor-author" x-text="reply.author"></span>
                    <span class="floor-number" x-text="reply.floor + 'æ¥¼'"></span>
                  </div>
                </div>
                <div class="floor-content" x-text="reply.content"></div>
                <div class="floor-time" x-text="reply.timestamp"></div>
              </div>
            </template>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('alpine:init', () => {
      // å…¨å±€ Store
      Alpine.store('tieba', {
        name: '',
        posts: [],
        currentPost: null,
        hasMore: true,
        _initializing: false, // é˜²æ­¢é‡å¤åˆå§‹åŒ–
        _generatingPosts: false, // é˜²æ­¢é‡å¤ç”Ÿæˆå¸–å­åˆ—è¡¨
        _generatingDetail: false, // é˜²æ­¢é‡å¤ç”Ÿæˆå¸–å­è¯¦æƒ…

        async init(name) {
          // éªŒè¯å‚æ•°
          if (!name || typeof name !== 'string' || !name.trim()) {
            console.error('init è°ƒç”¨å¤±è´¥ï¼šæ— æ•ˆçš„è´´å§åç§°', name);
            return;
          }

          // é˜²æ­¢é‡å¤è°ƒç”¨
          if (this._initializing) {
            console.log('init å·²åœ¨æ‰§è¡Œä¸­ï¼Œè·³è¿‡é‡å¤è°ƒç”¨');
            return;
          }

          this._initializing = true;
          this.name = name.trim();
          // æ¸…ç©ºæ—§æ•°æ®ï¼Œé˜²æ­¢æ··åˆ
          this.posts = [];
          this.currentPost = null;

          try {
            // ä» KV åŠ è½½ - ä½¿ç”¨è´´å§åç§°ä½œä¸º key çš„ä¸€éƒ¨åˆ†ï¼ˆv2ç‰ˆæœ¬ï¼Œä¸å«previewï¼‰
            const kvKey = `tieba_state_v2_${name}`;
            console.log(`å°è¯•åŠ è½½è´´å§: ${name}, KV key: ${kvKey}`);

            const data = await window.dzmm.kv.get(kvKey);
            console.log('KV è¿”å›:', data);

            if (data.value) {
              const state = data.value; // ç›´æ¥ä½¿ç”¨å¯¹è±¡ï¼Œä¸éœ€è¦ JSON.parse
              console.log(`ä»ç¼“å­˜åŠ è½½ ${state.posts?.length || 0} ä¸ªå¸–å­ï¼Œè´´å§å: ${state.name}`);
              this.posts = state.posts || [];
              return;
            }

            console.log('æ²¡æœ‰ç¼“å­˜ï¼Œå¼€å§‹ç”Ÿæˆæ–°å¸–å­');
            // æ–°è´´å§ï¼Œç”Ÿæˆåˆå§‹å¸–å­
            await this.generatePosts(10, true);
          } finally {
            this._initializing = false;
          }
        },

        async generatePosts(count = 5, isInit = false) {
          // é˜²æ­¢é‡å¤è°ƒç”¨
          if (this._generatingPosts) {
            console.log('generatePosts å·²åœ¨æ‰§è¡Œä¸­ï¼Œè·³è¿‡');
            return [];
          }

          this._generatingPosts = true;
          console.log('å¼€å§‹ç”Ÿæˆå¸–å­åˆ—è¡¨');

          const prompt = `ä½ æ˜¯"${this.name}å§"çš„æ´»è·ƒç”¨æˆ·ã€‚"${this.name}"åªæ˜¯è¿™ä¸ªè´´å§çš„åç§°ï¼Œä¸è¦åšå…¶ä»–è”æƒ³ã€‚

ã€æ ¸å¿ƒè§„åˆ™ã€‘
1. "${this.name}"å°±æ˜¯è´´å§çš„åå­—ï¼Œä¸æ˜¯ç¼–ç¨‹æœ¯è¯­ã€ä¸æ˜¯å…¶ä»–å«ä¹‰
2. æŠŠ"${this.name}"å½“ä½œä¸€ä¸ªæ™®é€šä¸»é¢˜è¯ï¼Œå›´ç»•å®ƒç”ŸæˆçœŸå®çš„è´´å§è®¨è®ºå†…å®¹
3. æ ‡é¢˜è¦çœŸå®ã€å¤šæ ·åŒ–ã€å¸å¼•äºº
4. ${isInit ? 'è¿™æ˜¯æ–°è´´å§ï¼Œç”Ÿæˆç¬¬ä¸€æ‰¹å†…å®¹' : 'é¿å…ä¸å·²æœ‰' + this.posts.length + 'ä¸ªå¸–å­é‡å¤'}

ã€ç¤ºä¾‹ç†è§£ã€‘
- å¦‚æœè´´å§åæ˜¯"ææ¯…"â†’ ç”Ÿæˆå…³äºææ¯…è¿™ä¸ªäººçš„è®¨è®º
- å¦‚æœè´´å§åæ˜¯"çŒ«å’ª"â†’ ç”Ÿæˆå…³äºçŒ«çš„å¯çˆ±æ—¥å¸¸
- å¦‚æœè´´å§åæ˜¯"æ—…æ¸¸"â†’ ç”Ÿæˆå…³äºæ—…è¡Œçš„ç»éªŒåˆ†äº«
- **ä¸è¦è”æƒ³ç¼–ç¨‹ã€æŠ€æœ¯ç­‰æ— å…³æ¦‚å¿µ**

ä½¿ç”¨XMLæ ‡ç­¾æ ¼å¼è¾“å‡ºæ¯ä¸ªå¸–å­ï¼š
<post>
<title>å¸–å­æ ‡é¢˜ï¼ˆä¸è¶…è¿‡30å­—ï¼‰</title>
<author>ç”¨æˆ·å</author>
<replyCount>éšæœº1-999çš„æ•°å­—</replyCount>
</post>

ç”Ÿæˆ${count}ä¸ªç¬¦åˆ"${this.name}"è¿™ä¸ªä¸»é¢˜çš„çœŸå®è´´å§å¸–å­ã€‚`;

          try {
            let content = '';
            await window.dzmm.completions(
              {
                model: 'nalang-xl',
                messages: [{ role: 'user', content: prompt }],
                maxTokens: 2000,
              },
              (newContent, done) => {
                content = newContent;
              }
            );

            // è¾“å‡ºåŸå§‹è¿”å›å†…å®¹ç”¨äºè°ƒè¯•
            console.log('===== AI è¿”å›çš„åŸå§‹å†…å®¹ =====');
            console.log(content);
            console.log('===== å†…å®¹ç»“æŸ =====');

            // æå–æ‰€æœ‰å¸–å­ï¼ˆä¸åŒ…å« previewï¼‰
            const postMatches = [...content.matchAll(/<post>[\s\S]*?<title>(.*?)<\/title>[\s\S]*?<author>(.*?)<\/author>[\s\S]*?<replyCount>(\d+)<\/replyCount>[\s\S]*?<\/post>/g)];

            console.log(`æå–åˆ° ${postMatches.length} ä¸ªå¸–å­`);

            if (postMatches.length === 0) {
              console.error('æ— æ³•è§£æå¸–å­:', content);
              return [];
            }

            // è¿‡æ»¤å’ŒéªŒè¯å¸–å­æ•°æ®
            const newPosts = postMatches
              .map(match => ({
                title: match[1].trim(),
                author: match[2].trim(),
                replyCount: parseInt(match[3])
              }))
              .filter(post => {
                // éªŒè¯å¿…è¦å­—æ®µéƒ½å­˜åœ¨ä¸”ä¸ä¸ºç©º
                const isValid = post.title &&
                               post.author &&
                               !isNaN(post.replyCount);

                if (!isValid) {
                  console.warn('è¿‡æ»¤æ‰ä¸å®Œæ•´çš„å¸–å­:', post);
                }
                return isValid;
              });

            // å¦‚æœè¿‡æ»¤åæ²¡æœ‰æœ‰æ•ˆå¸–å­ï¼Œä¸ä¿å­˜
            if (newPosts.length === 0) {
              console.error('æ²¡æœ‰ç”Ÿæˆæœ‰æ•ˆçš„å¸–å­');
              return [];
            }

            // æ·»åŠ å…ƒæ•°æ®
            const enrichedPosts = newPosts.map(post => ({
              id: `post_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
              ...post,
              avatar: this.generateAvatar(post.author),
              timestamp: this.generateTimestamp(),
              replyCount: post.replyCount || Math.floor(Math.random() * 100)
            }));

            this.posts.push(...enrichedPosts);
            await this.saveState();
            return enrichedPosts;
          } catch (error) {
            console.error('ç”Ÿæˆå¸–å­å¤±è´¥:', error);
            return [];
          } finally {
            this._generatingPosts = false;
            console.log('ç”Ÿæˆå¸–å­åˆ—è¡¨å®Œæˆï¼Œé‡Šæ”¾é”');
          }
        },

        async generatePostDetail(postId) {
          // é˜²æ­¢é‡å¤è°ƒç”¨
          if (this._generatingDetail) {
            console.log('generatePostDetail å·²åœ¨æ‰§è¡Œä¸­ï¼Œè·³è¿‡');
            return null;
          }

          this._generatingDetail = true;
          console.log('=== å¼€å§‹ç”Ÿæˆå¸–å­è¯¦æƒ… ===');
          console.log('postId:', postId);

          try {
            const post = this.posts.find(p => p.id === postId);
            if (!post) {
              console.error('æ‰¾ä¸åˆ°å¸–å­:', postId);
              return null;
            }

            console.log('æ‰¾åˆ°å¸–å­:', post);

            // æ£€æŸ¥ KV ç¼“å­˜ï¼ˆv2ç‰ˆæœ¬ï¼Œä½¿ç”¨æ–°çš„ç¼“å­˜keyé¿å…æ—§æ•°æ®ï¼‰
            const cacheKey = `post_v2_${postId}`;
            const cached = await window.dzmm.kv.get(cacheKey);
            console.log('ç¼“å­˜æ£€æŸ¥:', cacheKey, cached);

            if (cached.value) {
              console.log('ä½¿ç”¨ç¼“å­˜çš„å¸–å­è¯¦æƒ…');
              return cached.value; // ç›´æ¥è¿”å›å¯¹è±¡ï¼Œä¸éœ€è¦ JSON.parse
            }

            const prompt = `å±•å¼€"${this.name}å§"ä¸­çš„è¿™ä¸ªå¸–å­ï¼š

æ ‡é¢˜ï¼š${post.title}
ä½œè€…ï¼š${post.author}

ç”Ÿæˆï¼š
1. æ¥¼ä¸»å®Œæ•´å†…å®¹ï¼ˆ200-500å­—ï¼Œå›´ç»•æ ‡é¢˜å±•å¼€ï¼Œè¦æœ‰çœŸå®æ„Ÿï¼‰
2. 10æ¡çœŸå®å›å¤ï¼ˆæœ‰èµåŒã€åå¯¹ã€æç¬‘ã€è®¤çœŸç­‰ä¸åŒé£æ ¼ï¼‰

ä½¿ç”¨XMLæ ‡ç­¾æ ¼å¼è¾“å‡ºï¼š
<content>æ¥¼ä¸»çš„å®Œæ•´å†…å®¹</content>
<reply><author>ç”¨æˆ·å1</author><text>å›å¤å†…å®¹1</text></reply>
<reply><author>ç”¨æˆ·å2</author><text>å›å¤å†…å®¹2</text></reply>
...ï¼ˆå…±10æ¡å›å¤ï¼‰`;

            console.log('å‘é€ prompt åˆ° AI');

            let content = '';
            await window.dzmm.completions(
              {
                model: 'nalang-xl',
                messages: [{ role: 'user', content: prompt }],
                maxTokens: 3000,
              },
              (newContent, done) => {
                content = newContent;
              }
            );

            console.log('===== AI è¿”å›çš„å¸–å­è¯¦æƒ…å†…å®¹ =====');
            console.log(content);
            console.log('===== å†…å®¹ç»“æŸ =====');

            // æå–æ¥¼ä¸»å†…å®¹
            const contentMatch = content.match(/<content>([\s\S]*?)<\/content>/);
            if (!contentMatch) {
              console.error('æ— æ³•è§£ææ¥¼ä¸»å†…å®¹ï¼ŒåŸå§‹å†…å®¹:', content);
              return null;
            }

            console.log('æå–åˆ°æ¥¼ä¸»å†…å®¹:', contentMatch[1]);

            // æå–æ‰€æœ‰å›å¤
            const replyMatches = [...content.matchAll(/<reply>[\s\S]*?<author>(.*?)<\/author>[\s\S]*?<text>([\s\S]*?)<\/text>[\s\S]*?<\/reply>/g)];

            console.log(`æå–åˆ° ${replyMatches.length} æ¡å›å¤`);

            const detail = {
              content: contentMatch[1].trim(),
              replies: replyMatches.map(match => ({
                author: match[1].trim(),
                content: match[2].trim()
              }))
            };

            // æ·»åŠ å…ƒæ•°æ®
            const enrichedDetail = {
              id: postId,
              title: post.title,
              author: post.author,
              avatar: post.avatar,
              content: detail.content.replace(/\\n/g, '\n'),
              replies: detail.replies.slice(0, 10).map((reply, index) => ({
                floor: index + 1,
                author: reply.author,
                avatar: this.generateAvatar(reply.author),
                content: reply.content,
                timestamp: this.generateTimestamp()
              }))
            };

            // ä¿å­˜åˆ° KVï¼ˆä½¿ç”¨v2 keyï¼‰
            await window.dzmm.kv.put(cacheKey, enrichedDetail);
            return enrichedDetail;
          } catch (error) {
            console.error('ç”Ÿæˆå¸–å­è¯¦æƒ…å¤±è´¥:', error);
            return null;
          } finally {
            this._generatingDetail = false;
            console.log('ç”Ÿæˆå¸–å­è¯¦æƒ…å®Œæˆï¼Œé‡Šæ”¾é”');
          }
        },

        async saveState() {
          const kvKey = `tieba_state_v2_${this.name}`;
          await window.dzmm.kv.put(kvKey, {
            name: this.name,
            posts: this.posts
          });
        },

        generateAvatar(name) {
          const colors = [
            '#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A',
            '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E2'
          ];
          const hash = name.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
          return colors[hash % colors.length];
        },

        generateTimestamp() {
          const random = Math.random();
          if (random > 0.7) return 'åˆšåˆš';
          if (random > 0.4) return Math.floor(Math.random() * 60) + 'åˆ†é’Ÿå‰';
          if (random > 0.2) return Math.floor(Math.random() * 24) + 'å°æ—¶å‰';
          return Math.floor(Math.random() * 30) + 'å¤©å‰';
        }
      });

      // ä¸»ç»„ä»¶
      Alpine.data('tiebaApp', () => ({
        view: 'input',
        tiebaName: '',
        isLoading: false,
        scrollThreshold: 100,

        async init() {
          await new Promise((resolve) => {
            const handler = (event) => {
              if (event.data?.type === 'dzmm:ready') {
                window.removeEventListener('message', handler);
                resolve();
              }
            };
            window.addEventListener('message', handler);
          });
        },

        async enterTieba() {
          console.log('enterTieba è¢«è°ƒç”¨ï¼ŒtiebaName:', this.tiebaName, 'type:', typeof this.tiebaName);

          if (!this.tiebaName || typeof this.tiebaName !== 'string' || !this.tiebaName.trim()) {
            console.error('æ— æ•ˆçš„è´´å§åç§°ï¼Œåœæ­¢æ‰§è¡Œ', this.tiebaName);
            return;
          }

          if (this.isLoading) {
            console.log('æ­£åœ¨åŠ è½½ä¸­ï¼Œè·³è¿‡');
            return;
          }

          const trimmedName = this.tiebaName.trim();
          console.log('å‡†å¤‡è¿›å…¥è´´å§:', trimmedName);

          this.isLoading = true;
          await this.$store.tieba.init(trimmedName);
          this.isLoading = false;
          this.view = 'list';
        },

        async loadMore() {
          console.log('loadMore è¢«è°ƒç”¨ï¼ŒisLoading:', this.isLoading, 'hasMore:', this.$store.tieba.hasMore);

          if (this.isLoading || !this.$store.tieba.hasMore) {
            console.log('loadMore è¢«è·³è¿‡');
            return;
          }

          console.log('å¼€å§‹åŠ è½½æ›´å¤šå¸–å­');
          this.isLoading = true;
          await this.$store.tieba.generatePosts(5);
          this.isLoading = false;
        },

        async viewPost(postId) {
          // å…ˆæ¸…ç©ºå½“å‰å¸–å­ï¼Œåˆ‡æ¢åˆ°è¯¦æƒ…é¡µï¼Œæ˜¾ç¤º loading
          this.$store.tieba.currentPost = null;
          this.view = 'detail';
          window.scrollTo(0, 0);

          this.isLoading = true;
          const detail = await this.$store.tieba.generatePostDetail(postId);
          this.isLoading = false;

          if (detail) {
            this.$store.tieba.currentPost = detail;
          } else {
            // ç”Ÿæˆå¤±è´¥ï¼Œè¿”å›åˆ—è¡¨
            this.backToList();
          }
        },

        backToList() {
          this.view = 'list';
          this.$store.tieba.currentPost = null;
          window.scrollTo(0, 0);
        },

        backToInput() {
          this.view = 'input';
          this.tiebaName = '';
          this.$store.tieba.posts = [];
          this.$store.tieba.name = '';
          window.scrollTo(0, 0);
        },

        handleScroll() {
          if (this.view !== 'list') return;

          const scrollHeight = document.documentElement.scrollHeight;
          const scrollTop = window.scrollY;
          const clientHeight = window.innerHeight;

          if (scrollHeight - scrollTop - clientHeight < this.scrollThreshold) {
            this.loadMore();
          }
        }
      }));
    });
  </script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
      background: #f5f5f5;
      color: #333;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* è¾“å…¥é¡µ */
    .input-view {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .input-container {
      text-align: center;
      color: white;
      padding: 40px 20px;
    }

    .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 15px;
    }

    .logo-icon {
      width: 60px;
      height: 60px;
      background: white;
      color: #3E6FBF;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      font-weight: bold;
    }

    .logo h1 {
      font-size: 36px;
      font-weight: bold;
    }

    .subtitle {
      font-size: 16px;
      opacity: 0.9;
      margin-bottom: 40px;
    }

    .search-box {
      max-width: 500px;
      margin: 0 auto;
    }

    .search-box input {
      width: 100%;
      padding: 15px 20px;
      border: none;
      border-radius: 8px 8px 0 0;
      font-size: 16px;
      outline: none;
    }

    .enter-btn {
      width: 100%;
      padding: 15px;
      background: #3E6FBF;
      color: white;
      border: none;
      border-radius: 0 0 8px 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }

    .enter-btn:hover:not(:disabled) {
      background: #2d5aa0;
    }

    .enter-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* å¤´éƒ¨å¯¼èˆªæ  */
    .header-bar {
      background: white;
      border-bottom: 1px solid #e5e5e5;
      padding: 15px 0;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-bar .container {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .back-btn {
      padding: 8px 16px;
      background: #f5f5f5;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
    }

    .back-btn:hover {
      background: #e5e5e5;
    }

    .tieba-title {
      font-size: 20px;
      color: #3E6FBF;
      font-weight: bold;
    }

    /* åˆ—è¡¨é¡µ */
    .list-view {
      min-height: 100vh;
      padding-bottom: 40px;
    }

    .post-list {
      margin-top: 20px;
    }

    .post-item {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 15px;
      display: flex;
      gap: 15px;
      cursor: pointer;
      transition: all 0.3s;
      border: 1px solid #e5e5e5;
    }

    .post-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      border-color: #3E6FBF;
    }

    .post-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .post-content {
      flex: 1;
      min-width: 0;
    }

    .post-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 8px;
      color: #333;
    }

    .post-preview {
      color: #666;
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 10px;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .post-meta {
      display: flex;
      gap: 15px;
      font-size: 13px;
      color: #999;
    }

    .post-author {
      color: #3E6FBF;
      font-weight: 500;
    }

    /* è¯¦æƒ…é¡µ */
    .detail-view {
      min-height: 100vh;
      padding-bottom: 40px;
    }

    .post-detail {
      margin-top: 20px;
    }

    .detail-title {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 20px;
      padding: 20px;
      background: white;
      border-radius: 8px;
    }

    .floor-item {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 15px;
      border: 1px solid #e5e5e5;
    }

    .floor-main {
      border-left: 4px solid #3E6FBF;
    }

    .floor-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 15px;
    }

    .floor-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .floor-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .floor-author {
      font-weight: bold;
      color: #3E6FBF;
    }

    .floor-label {
      background: #3E6FBF;
      color: white;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 12px;
    }

    .floor-number {
      color: #999;
      font-size: 14px;
    }

    .floor-content {
      line-height: 1.8;
      color: #333;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .floor-time {
      margin-top: 10px;
      font-size: 13px;
      color: #999;
    }

    /* åŠ è½½çŠ¶æ€ */
    .loading-state {
      text-align: center;
      padding: 40px;
      color: #999;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3E6FBF;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ç©ºçŠ¶æ€ */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
      font-size: 16px;
    }

    /* å“åº”å¼ */
    @media (max-width: 768px) {
      .logo h1 {
        font-size: 28px;
      }

      .post-item {
        padding: 15px;
      }

      .post-title {
        font-size: 16px;
      }

      .detail-title {
        font-size: 20px;
        padding: 15px;
      }
    }
  </style>

  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</body>
</html>